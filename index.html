async function connectWatch() {
    const statusEl = document.getElementById('status');
    try {
        // બધી વોચ દેખાય એ રીતે સ્કેનિંગ
        const device = await navigator.bluetooth.requestDevice({
            acceptAllDevices: true,
            optionalServices: [
                'heart_rate', 
                'battery_service', 
                '0000180d-0000-1000-8000-00805f9b34fb', // Standard HR
                '0000fee0-0000-1000-8000-00805f9b34fb'  // Mi/DaFit Specific
            ]
        });

        const server = await device.gatt.connect();
        statusEl.innerText = "કનેક્ટ થઈ ગયું! સર્વિસ શોધી રહ્યો છું...";

        // બધી જ સર્વિસ જે વોચમાં ઉપલબ્ધ છે એની યાદી મેળવો
        const services = await server.getPrimaryServices();
        
        let foundAny = false;
        for (const service of services) {
            console.log("સર્વિસ મળી: " + service.uuid);
            const chars = await service.getCharacteristics();
            for (const char of chars) {
                if (char.properties.notify) {
                    await char.startNotifications();
                    char.addEventListener('characteristicvaluechanged', (e) => {
                        let val = e.target.value.getUint8(1) || e.target.value.getUint8(0);
                        document.getElementById('hr-display').innerText = val;
                        foundAny = true;
                    });
                }
            }
        }
        
        if(!foundAny) statusEl.innerText = "વોચ તો જોડાઈ પણ ડેટા લૉક છે ભાઈ!";

    } catch (error) {
        alert("ભૂલ: " + error.message);
    }
}
